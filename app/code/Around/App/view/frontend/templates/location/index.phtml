<div class="brand-wrapper">
    <img src="
		<?php echo $block->getLogoSrc();?>" alt="logo">
    <br>
</div>
<head>
    <title>Address form</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">

</head>


<script type="text/javascript" src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>







<style>


    #map{
        height:400px;

    }

</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCh0qDXpKwtRpHKZq7OxU2z3YBWbAFRM7w&callback=initMap&libraries=places" async defer>
</script>

<div class="form-group">
    <button id ="btn" onclick="">Current Location</button>
    <input type="text" id="searchmap" name ="Location" placeholder="Enter the Location">
    <br>
    <br>
    <div id="map">

    </div>
</div>

<div class="form-group">
    <label for="">Latitude</label>
    <input type="text" class="form-control input-sm col-md-4" name="lat" id="lat">
</div>

<div class="form-group">
    <label for="">Longitude</label>
    <input type="text" class="form-control input-sm col-md-4" name="lng" id="lng">
</div>



<button class="location-submit btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter">Confirm Location</button>


<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Add your address</h5>
            </div>
            <div class="modal-body">
                <form action="<?php echo $block->getUrl("login/location/submit");?>" method="post">
                    <input type="hidden" id="lat1" name="lat" value="">
                    <input type="hidden" id="lng1" name="lng" value="">
                    <section>
                        <label for="name">Name</label>
                        <input id="name" name="name" autocomplete="name" maxlength="100" pattern="[\p{L} \-\.]+" required>
                    </section>
                    <section>
                        <label for="address">Plot No</label>
                        <input id="address" name="plot_no" autocomplete="address" maxlength="50" required />
                    </section>
                    <section>
                        <label for="address">Apartment name (If applicable)</label>
                        <input id="address" name="apartment_name" autocomplete="address" maxlength="50" />
                    </section>
                    Save as:

            </div>
            <div class="btn-group">
                <input class="btn-check" type="radio" name="type" value="home" id="dolores_ck">
                <label class="btn btn-outline-info" for="dolores_ck">
                    Home
                </label>

                <input class="btn-check" type="radio" name="type" value="office" id="bubbles_ck">
                <label class="btn btn-outline-info" for="bubbles_ck">
                    Office
                </label>

                <input class="btn-check" type="radio" name="type" value="others" id="cosmo_ck">
                <label class="btn btn-outline-info" for="cosmo_ck">
                    Others
                </label>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary" onclick="
				<?php echo $block->getUrl("login/location/submit/");?>"> Save address </button>
            </div>

            </form>
        </div>
    </div>
</div>

<script>

    var map, infoWindow;

    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: 12.971599, lng: 77.594563},
            zoom: 18,
            draggable: true,
            fullscreenControl: false,
            mapTypeControl: false,
            streetViewControl: false
        });
        infoWindow = new google.maps.InfoWindow;

        var marker = new google.maps.Marker({
            map: map,
            draggable: false,
        });

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                marker.setPosition(pos);
                map.setCenter(pos);

            }, function() {
                handleLocationError(true, infoWindow, map.getCenter());

            });

            google.maps.event.addDomListener(btn, 'click', function(){
                navigator.geolocation.getCurrentPosition(function(position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    marker.setPosition(pos);
                    map.setCenter(pos);

                    currentloc(marker);

                }, function() {
                    handleLocationError(true, infoWindow, map.getCenter());

                });

            });

        } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
        }

        var searchBox = new google.maps.places.SearchBox(document.getElementById('searchmap'));
        google.maps.event.addListener(searchBox,'places_changed',function(){
            var places = searchBox.getPlaces();
            var bounds = new google.maps.LatLngBounds();
            var i,place;
            for(i=0; place=places[i]; i++){
                bounds.extend(place.geometry.location);
                marker.setPosition(place.geometry.location);
            }
            map.fitBounds(bounds);
            map.setZoom(18);
        });
        google.maps.event.addListener(map, 'drag', function () {
            marker.setPosition(map.getCenter());
        });
        google.maps.event.addListener(marker, 'dragend', function() {

            latlng = marker.getPosition();
            url = 'https://maps.googleapis.com/maps/api/geocode/json?latlng='+ latlng.lat() + ',' + latlng.lng() + '&sensor=false';
            $.get(url, function(data) {
                if (data.status == 'OK') {
                    map.setCenter(data.results[0].geometry.location);
                    if (confirm('Do you also want to change location text to ' + data.results[0].formatted_address) === true) {
                        $('#searchmap').val(data.results[0].formatted_address);
                        $('#lat').val(data.results[0].geometry.location.lat);
                        $('#lng').val(data.results[0].geometry.location.lng);
                    }
                }
            });
        });
    }

    function currentloc(marker){
        latlng = marker.getPosition();
        url = 'https://maps.googleapis.com/maps/api/geocode/json?latlng='+ latlng.lat() + ',' + latlng.lng() + '&sensor=false';
        $.get(url, function(data) {
            if (data.status == 'OK') {
                map.setCenter(data.results[0].geometry.location);
                if (confirm('Do you also want to change location text to ' + data.results[0].formatted_address) === true) {
                    $('#searchmap').val(data.results[0].formatted_address);
                    $('#lat').val(data.results[0].geometry.location.lat);
                    $('#lng').val(data.results[0].geometry.location.lng);
                }
            }
        });
    }

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
            'Error: The Geolocation service failed.' :
            'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
    }



</script>
